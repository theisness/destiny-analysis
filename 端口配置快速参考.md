# 端口配置快速参考 ⚡

## 🎯 默认端口

| 服务 | 端口 | 说明 |
|------|------|------|
| **前端** | 3000 | React 开发服务器 |
| **后端** | 5000 | Express API 服务器 |
| **MongoDB** | 27017 | 数据库 |

---

## 🔧 修改前端端口

### 方法1：修改配置文件（推荐）

**文件：** `frontend/.env`

```env
PORT=8080  # 修改为你想要的端口
```

**重启服务器：**
```bash
Ctrl + C  # 停止
npm start # 重新启动
```

---

### 方法2：命令行指定

**Windows:**
```bash
set PORT=8080 && npm start
```

**Mac/Linux:**
```bash
PORT=8080 npm start
```

---

### 方法3：package.json 脚本

**文件：** `frontend/package.json`

```json
{
  "scripts": {
    "start": "PORT=8080 react-scripts start"
  }
}
```

---

## 🔧 修改后端端口

### 方法：修改配置文件

**文件：** `backend/.env`

```env
PORT=8000  # 修改为你想要的端口
```

**注意：** 如果修改后端端口，前端也需要更新 API 地址！

**文件：** `frontend/.env`

```env
REACT_APP_API_URL=http://localhost:8000/api
```

---

## 🚨 端口被占用怎么办？

### 查看占用端口的进程

**Windows:**
```bash
netstat -ano | findstr :3000
```

**Mac/Linux:**
```bash
lsof -ti:3000
```

---

### 关闭占用端口的进程

**Windows:**
```bash
# 找到 PID 后
taskkill /PID <PID> /F
```

**Mac/Linux:**
```bash
kill -9 $(lsof -ti:3000)
```

---

### 或者使用其他端口

修改 `frontend/.env`：
```env
PORT=3001  # 使用其他端口
```

---

## 💡 常见场景

### 场景1：3000 端口被占用
```env
# frontend/.env
PORT=3001
```

访问：`http://localhost:3001`

---

### 场景2：同时运行多个项目
```env
# 项目A - frontend/.env
PORT=3000

# 项目B - frontend/.env
PORT=3001

# 项目C - frontend/.env
PORT=3002
```

---

### 场景3：公司规定端口
```env
# frontend/.env
PORT=8080

# backend/.env
PORT=8000
```

别忘了更新前端 API 地址：
```env
# frontend/.env
REACT_APP_API_URL=http://localhost:8000/api
```

---

### 场景4：使用代理避免跨域
使用 Nginx 或前端代理，前后端可以在同一域名不同路径：

```
http://localhost:3000/       → 前端
http://localhost:3000/api/   → 后端（代理）
```

**frontend/package.json:**
```json
{
  "proxy": "http://localhost:5000"
}
```

---

## 🎨 完整配置示例

### 默认配置（3000 + 5000）

**frontend/.env:**
```env
PORT=3000
REACT_APP_API_URL=http://localhost:5000/api
```

**backend/.env:**
```env
PORT=5000
MONGODB_URI=mongodb://localhost:27017/destiny-analysis
```

---

### 自定义端口（8080 + 8000）

**frontend/.env:**
```env
PORT=8080
REACT_APP_API_URL=http://localhost:8000/api
```

**backend/.env:**
```env
PORT=8000
MONGODB_URI=mongodb://localhost:27017/destiny-analysis
```

访问：
- 前端：`http://localhost:8080`
- 后端：`http://localhost:8000`

---

## 🔍 验证端口配置

### 前端
1. 启动服务：`npm start`
2. 查看控制台输出：
   ```
   Local:            http://localhost:你的端口
   ```
3. 在浏览器中访问显示的地址

### 后端
1. 启动服务：`npm run dev`
2. 查看控制台输出：
   ```
   服务器运行在端口 你的端口
   ```
3. 访问：`http://localhost:你的端口`

---

## ⚠️ 注意事项

1. **前后端端口必须匹配**
   - 后端端口：`backend/.env` 中的 `PORT`
   - 前端 API 地址：`frontend/.env` 中的 `REACT_APP_API_URL`

2. **修改后必须重启**
   - 前端：Ctrl+C 停止，然后 `npm start`
   - 后端：Ctrl+C 停止，然后 `npm run dev`

3. **Docker 环境端口映射**
   ```yaml
   # docker-compose.yml
   frontend:
     ports:
       - "8080:3000"  # 本机8080映射到容器3000
   
   backend:
     ports:
       - "8000:5000"  # 本机8000映射到容器5000
   ```

4. **生产环境**
   - 通常使用 Nginx 反向代理
   - 前端编译为静态文件
   - 不需要配置前端端口

---

## 🆘 故障排除

### 问题：端口修改不生效

**检查清单：**
- [ ] 确认修改了正确的 `.env` 文件
- [ ] 确认没有拼写错误（`PORT=3000`）
- [ ] 确认已经重启服务器
- [ ] 确认没有多个 `.env` 文件冲突

---

### 问题：前端无法连接后端

**检查清单：**
- [ ] 后端是否正在运行
- [ ] `REACT_APP_API_URL` 地址是否正确
- [ ] 后端端口与 API 地址中的端口是否一致
- [ ] 浏览器控制台是否有 CORS 错误

---

### 问题：React 提示端口冲突

**提示信息：**
```
? Something is already running on port 3000.

Would you like to run the app on another port instead? › (Y/n)
```

**解决方案：**
- 选择 Y → React 会自动使用 3001
- 或在 `.env` 中提前设置 `PORT=3001`

---

## 📚 更多信息

- [前端配置说明.md](./前端配置说明.md) - 完整的前端配置文档
- [快速开始.md](./快速开始.md) - 项目启动指南
- [README.md](./README.md) - 项目完整文档

---

## 🎯 快速命令

```bash
# 查看端口占用（Windows）
netstat -ano | findstr :3000

# 查看端口占用（Mac/Linux）
lsof -ti:3000

# 杀死进程（Windows）
taskkill /PID <PID> /F

# 杀死进程（Mac/Linux）
kill -9 $(lsof -ti:3000)

# 指定端口启动（Windows）
set PORT=8080 && npm start

# 指定端口启动（Mac/Linux）
PORT=8080 npm start
```

---

**提示：** 大多数情况下，使用默认端口（前端3000，后端5000）即可！

---

*最后更新：2024年*

