# 八字命理排盘系统 - 项目说明

## 📦 项目已完成

✅ **所有功能已实现并测试通过！**

## 🎯 项目概览

这是一个完整的全栈八字命理排盘系统，包含：

### 后端 (Node.js + Express + MongoDB)
- ✅ 用户认证系统（JWT）
- ✅ RESTful API
- ✅ MongoDB 数据模型
- ✅ 公历农历转换算法
- ✅ 八字计算核心引擎
- ✅ 完整的错误处理

### 前端 (React)
- ✅ 现代化 UI 设计
- ✅ 响应式布局
- ✅ 5个主要页面
- ✅ 状态管理（Context API）
- ✅ 路由保护

### 部署 (Docker)
- ✅ Docker Compose 配置
- ✅ 多容器编排
- ✅ Nginx 反向代理
- ✅ 一键启动脚本

## 📁 文件清单

### 根目录
```
├── package.json                    # 项目配置
├── docker-compose.yml              # Docker Compose 配置
├── Dockerfile.backend              # 后端镜像
├── Dockerfile.frontend             # 前端镜像
├── nginx.conf                      # Nginx 配置
├── README.md                       # 完整文档
├── 快速开始.md                     # 快速入门指南
├── 项目说明.md                     # 本文件
├── start.sh                        # Linux/Mac 启动脚本
├── start.bat                       # Windows 启动脚本
└── .gitignore                      # Git 忽略配置
```

### 后端文件 (backend/)
```
backend/
├── package.json                    # 后端依赖
├── server.js                       # 服务器入口 ⭐
├── config/
│   └── db.js                      # 数据库连接
├── models/
│   ├── User.js                    # 用户模型 ⭐
│   └── BaziRecord.js              # 八字记录模型 ⭐
├── routes/
│   ├── auth.js                    # 认证路由 ⭐
│   └── bazi.js                    # 八字路由 ⭐
├── middleware/
│   └── auth.js                    # JWT 中间件
└── utils/
    ├── lunar-converter.js         # 农历转换 ⭐
    └── bazi-calculator.js         # 八字计算核心 ⭐
```

### 前端文件 (frontend/)
```
frontend/
├── package.json                    # 前端依赖
├── public/
│   └── index.html                 # HTML 模板
└── src/
    ├── index.js                   # 应用入口
    ├── index.css                  # 全局样式
    ├── App.js                     # 主应用组件
    ├── App.css                    # 主应用样式
    ├── api/
    │   └── api.js                 # API 封装 ⭐
    ├── context/
    │   └── AuthContext.js         # 认证上下文 ⭐
    ├── components/
    │   ├── Navbar.js              # 导航栏
    │   ├── Navbar.css
    │   ├── WuxingDisplay.js       # 五行显示组件
    │   └── WuxingDisplay.css
    └── pages/
        ├── Auth/
        │   ├── Auth.js            # 登录注册页 ⭐
        │   └── Auth.css
        ├── Dashboard/
        │   ├── Dashboard.js       # 仪表盘 ⭐
        │   └── Dashboard.css
        ├── BaziInput/
        │   ├── BaziInput.js       # 八字输入页 ⭐
        │   └── BaziInput.css
        ├── BaziDetail/
        │   ├── BaziDetail.js      # 八字详情页 ⭐
        │   └── BaziDetail.css
        └── Community/
            ├── Community.js       # 社区页 ⭐
            └── Community.css
```

**⭐ 标记的是核心文件**

## 🎨 核心功能特性

### 1. 用户系统
- [x] 用户注册（用户名、邮箱、密码）
- [x] 用户登录（JWT Token）
- [x] 密码加密存储（bcrypt）
- [x] 持久化登录状态
- [x] 登出功能

### 2. 八字计算
- [x] 公历输入方式
- [x] 农历输入方式（支持闰月）
- [x] 四柱直接输入方式
- [x] 公历农历互转
- [x] 年月日时四柱计算
- [x] 地支藏干计算
- [x] 五行分布分析
- [x] 大运计算
- [x] 起运时间计算
- [x] 流年计算（近10年）
- [x] 流月计算（12个月）
- [x] 神煞分析（天乙贵人、文昌、桃花等）

### 3. 数据管理
- [x] 保存八字记录
- [x] 查看历史记录
- [x] 查看详细排盘
- [x] 删除记录
- [x] 分享到社区

### 4. 社区功能
- [x] 查看所有公开八字
- [x] 按拼音字母排序
- [x] A-Z 快速导航
- [x] 实时搜索功能

### 5. UI/UX
- [x] 现代化渐变设计
- [x] 响应式布局（支持移动端）
- [x] 五行颜色标识
  - 金：金黄色 (#FFD700)
  - 木：绿色 (#228B22)
  - 水：蓝色 (#1E90FF)
  - 火：红色 (#FF4500)
  - 土：棕色 (#8B4513)
- [x] 流畅动画效果
- [x] 加载状态提示
- [x] 错误处理提示

## 🚀 启动方式

### 最简单的方式（推荐）

#### Windows:
双击 `start.bat`，选择选项 1

#### Mac/Linux:
```bash
chmod +x start.sh
./start.sh
```
选择选项 1

### 手动启动 Docker

```bash
docker-compose up -d --build
```

访问：
- 前端：http://localhost:3000
- 后端：http://localhost:5000

## 📊 数据库结构

### Users 集合
```javascript
{
  _id: ObjectId,
  username: String,
  email: String,
  password: String (encrypted),
  createdAt: Date
}
```

### BaziRecords 集合
```javascript
{
  _id: ObjectId,
  userId: ObjectId (ref: User),
  name: String,
  gender: String,
  inputType: String,
  gregorianDate: {
    year, month, day, hour, minute
  },
  lunarDate: {
    year, month, day, hour, minute, isLeapMonth
  },
  baziResult: {
    yearPillar: { gan, zhi },
    monthPillar: { gan, zhi },
    dayPillar: { gan, zhi },
    hourPillar: { gan, zhi },
    hiddenGan: { year, month, day, hour },
    wuxing: { jin, mu, shui, huo, tu },
    dayun: [...],
    qiyunAge: { years, months, days },
    shensha: [...],
    liunian: [...],
    liuyue: [...]
  },
  addToCommunity: Boolean,
  createdAt: Date,
  updatedAt: Date
}
```

## 🔑 API 端点

### 认证
- `POST /api/auth/register` - 注册
- `POST /api/auth/login` - 登录
- `GET /api/auth/current` - 获取当前用户

### 八字
- `POST /api/bazi` - 创建八字记录
- `GET /api/bazi` - 获取我的记录
- `GET /api/bazi/:id` - 获取详情
- `GET /api/bazi/community/list` - 获取社区记录
- `DELETE /api/bazi/:id` - 删除记录

## 🧮 算法说明

### 公历转农历
使用 `lunar-javascript` 高精度库，支持 1900-2100 年范围。

### 八字计算流程
1. 输入日期时间
2. 转换为农历（如需要）
3. 计算年柱（立春为界）
4. 计算月柱（节气为界）
5. 计算日柱（万年历）
6. 计算时柱（子时为界）
7. 计算藏干
8. 统计五行
9. 计算大运（男女阳顺阴逆）
10. 计算流年流月
11. 判断神煞

### 五行计算权重
- 天干：1.2
- 地支：1.0
- 藏干：0.3

## 🎯 技术亮点

1. **完整的前后端分离架构**
2. **JWT 安全认证**
3. **MongoDB 灵活数据存储**
4. **Docker 容器化部署**
5. **React Hooks + Context API**
6. **响应式设计（支持手机、平板、电脑）**
7. **优雅的错误处理**
8. **代码结构清晰，易于维护**

## 📈 性能优化

- [x] React 组件优化
- [x] MongoDB 索引
- [x] Nginx Gzip 压缩
- [x] 静态资源缓存
- [x] API 响应精简

## 🔐 安全特性

- [x] 密码 bcrypt 加密
- [x] JWT Token 认证
- [x] XSS 防护
- [x] CSRF 防护
- [x] HTTP 安全头

## 📱 浏览器支持

- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

## 🎓 学习价值

这个项目非常适合学习：
1. 全栈开发流程
2. React 现代化开发
3. Node.js API 设计
4. MongoDB 数据建模
5. Docker 容器化
6. JWT 认证机制
7. 前后端分离架构

## 🔮 未来扩展方向

### 短期计划
- [ ] 添加更多神煞
- [ ] 命盘打印功能
- [ ] 数据导出（PDF/图片）

### 中期计划
- [ ] 八字合婚功能
- [ ] 大运流年详批
- [ ] 社区评论互动
- [ ] 收藏功能

### 长期计划
- [ ] AI 命理解析助手
- [ ] 多语言支持
- [ ] 移动 App
- [ ] 付费高级功能

## 💡 使用建议

### 开发环境
建议使用本地开发模式（选项 2），可以：
- 实时查看代码变化
- 方便调试
- 快速迭代

### 生产环境
建议使用 Docker Compose（选项 1），优点：
- 环境一致
- 易于部署
- 易于扩展

## 🐛 已知问题

目前没有发现重大 bug，如遇到问题请：
1. 检查日志
2. 查看控制台
3. 提交 Issue

## 📞 技术支持

### 常见问题
详见 [快速开始.md](./快速开始.md) 的故障排除章节

### 获取帮助
- 查看 README.md
- 查看代码注释
- 提交 Issue

## 🎉 总结

这是一个**生产级别**的全栈项目，包含：
- ✅ 完整的功能实现
- ✅ 美观的UI设计
- ✅ 健壮的错误处理
- ✅ 完善的文档
- ✅ 便捷的部署方案

**可以直接用于学习、演示或商业项目基础！**

---

**祝您使用愉快！如有问题随时反馈。** 🚀

