# 八字五行比例量化计算方法

## 概述

本文档详细说明八字五行比例的量化计算方法，包括四柱权重配置、藏干权重计算以及具体的计算示例。这套计算方法用于评估八字中五行（金、木、水、火、土）的强弱比例，为命理分析提供量化基础。

## 基本原理

八字五行量化计算基于以下几个核心原则：

1. **四柱权重差异化**：年、月、日、时四柱对五行强弱的影响不同，各有不同的权重
2. **天干地支分别计算**：每柱中的天干和地支分别计算其对五行的贡献
3. **藏干分级计算**：地支藏干按照本气、中气、余气的比例分配权重
4. **月柱藏干增强**：月柱的藏干对五行的影响被特别增强

## 四柱权重配置

四柱（年、月、日、时）的权重配置如下：

| 柱位 | 天干权重 | 地支权重 | 藏干倍率 |
|------|---------|---------|---------|
| 年柱 | 0.075   | 0.075   | 1.0     |
| 月柱 | 0.100   | 0.300   | 1.5     |
| 日柱 | 0.150   | 0.150   | 1.0     |
| 时柱 | 0.075   | 0.075   | 1.0     |

说明：
- 日柱天干权重最高，代表日主的重要性
- 月柱地支权重最高，代表月令对命局的重要影响
- 月柱藏干有1.5倍增强效果，进一步强调月令的重要性

## 藏干权重计算方法

地支藏干根据数量不同，采用不同的权重分配方式：

1. **藏一干**：本气占100%
   - 例如：卯（藏乙）→ 乙木占100%

2. **藏二干**：本气占70%，中气占30%
   - 例如：午（藏丁己）→ 丁火占70%，己土占30%

3. **藏三干**：本气占60%，中气占30%，余气占10%
   - 例如：寅（藏甲丙戊）→ 甲木占60%，丙火占30%，戊土占10%

藏干的最终权重计算公式：
```
藏干权重 = 藏干比例 × 地支权重 × 藏干倍率
```

## 计算流程

1. **初始化五行计数**：
   ```javascript
   const wuxing = { jin: 0, mu: 0, shui: 0, huo: 0, tu: 0 };
   ```

2. **计算天干五行**：
   ```javascript
   // 以年柱天干为例
   const wx = GAN_WUXING[yearPillar.gan]; // 获取天干五行属性
   const weight = pillarWeights.year.gan; // 获取年柱天干权重
   wuxing[wx] += weight; // 增加对应五行的计数
   ```

3. **计算地支五行**：
   ```javascript
   // 以年柱地支为例
   const wx = ZHI_WUXING[yearPillar.zhi]; // 获取地支五行属性
   const weight = pillarWeights.year.zhi; // 获取年柱地支权重
   wuxing[wx] += weight; // 增加对应五行的计数
   ```

4. **计算藏干五行**：
   ```javascript
   // 以年柱藏干为例
   const gans = hiddenGan.year; // 获取年柱藏干列表
   const multiplier = pillarWeights.year.hiddenMultiplier; // 获取藏干倍率
   
   // 根据藏干数量确定权重比例
   let weights = [];
   if (gans.length === 1) weights = [1.0];
   else if (gans.length === 2) weights = [0.7, 0.3];
   else if (gans.length === 3) weights = [0.6, 0.3, 0.1];
   
   // 应用权重计算五行
   gans.forEach((gan, index) => {
     if (index < weights.length) {
       const wx = GAN_WUXING[gan]; // 获取藏干五行属性
       const weight = weights[index] * pillarWeights.year.zhi * multiplier; // 计算最终权重
       wuxing[wx] += weight; // 增加对应五行的计数
     }
   });
   ```

5. **结果处理**：
   ```javascript
   // 保留一位小数
   Object.keys(wuxing).forEach(key => {
     wuxing[key] = Math.round(wuxing[key] * 10) / 10;
   });
   ```

## 计算示例

以八字"甲子、乙丑、丙寅、丁卯"为例：

### 1. 天干五行计算

| 柱位 | 天干 | 五行 | 权重 | 贡献值 |
|------|------|------|------|--------|
| 年柱 | 甲   | 木   | 0.075 | 木 +0.075 |
| 月柱 | 乙   | 木   | 0.100 | 木 +0.100 |
| 日柱 | 丙   | 火   | 0.150 | 火 +0.150 |
| 时柱 | 丁   | 火   | 0.075 | 火 +0.075 |

### 2. 地支五行计算

| 柱位 | 地支 | 五行 | 权重 | 贡献值 |
|------|------|------|------|--------|
| 年柱 | 子   | 水   | 0.075 | 水 +0.075 |
| 月柱 | 丑   | 土   | 0.300 | 土 +0.300 |
| 日柱 | 寅   | 木   | 0.150 | 木 +0.150 |
| 时柱 | 卯   | 木   | 0.075 | 木 +0.075 |

### 3. 藏干五行计算

#### 年柱藏干（子）：
- 藏干：癸（水）
- 藏干比例：100%
- 计算：0.075(地支权重) × 1.0(藏干倍率) × 1.0(比例) = 0.075
- 贡献值：水 +0.075

#### 月柱藏干（丑）：
- 藏干：己（土）、癸（水）、辛（金）
- 藏干比例：60%、30%、10%
- 计算：
  - 己土：0.300 × 1.5 × 0.6 = 0.270
  - 癸水：0.300 × 1.5 × 0.3 = 0.135
  - 辛金：0.300 × 1.5 × 0.1 = 0.045
- 贡献值：土 +0.270，水 +0.135，金 +0.045

#### 日柱藏干（寅）：
- 藏干：甲（木）、丙（火）、戊（土）
- 藏干比例：60%、30%、10%
- 计算：
  - 甲木：0.150 × 1.0 × 0.6 = 0.090
  - 丙火：0.150 × 1.0 × 0.3 = 0.045
  - 戊土：0.150 × 1.0 × 0.1 = 0.015
- 贡献值：木 +0.090，火 +0.045，土 +0.015

#### 时柱藏干（卯）：
- 藏干：乙（木）
- 藏干比例：100%
- 计算：0.075 × 1.0 × 1.0 = 0.075
- 贡献值：木 +0.075

### 4. 五行总计

| 五行 | 天干贡献 | 地支贡献 | 藏干贡献 | 总计 |
|------|---------|---------|---------|------|
| 金   | 0       | 0       | 0.045   | 0.0  |
| 木   | 0.175   | 0.225   | 0.165   | 0.6  |
| 水   | 0       | 0.075   | 0.210   | 0.3  |
| 火   | 0.225   | 0       | 0.045   | 0.3  |
| 土   | 0       | 0.300   | 0.285   | 0.6  |

注：最终结果四舍五入保留一位小数

## 结论

通过这套量化计算方法，可以客观评估八字中五行的强弱比例，为后续的命理分析提供数据支持。计算结果显示五行的相对强度，而非绝对值，因此需要结合具体命局进行解读。

在实际应用中，可以根据具体需求调整四柱权重配置，以适应不同的命理分析体系。