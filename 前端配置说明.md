# 前端配置说明

## 📋 概述

前端项目**可以**使用 `.env` 文件来配置环境变量，但**不是必需的**，因为代码中有默认值。

---

## ✅ 自动配置

当您使用**本地开发模式**（选项 2）启动时，启动脚本会自动创建 `frontend/.env` 文件。

### 默认配置
```env
# 前端环境变量配置

# 后端 API 地址
REACT_APP_API_URL=http://localhost:5000/api

# 前端开发服务器端口（默认3000）
PORT=3000

# 如果端口被占用，是否自动选择其他端口
# BROWSER=none  # 不自动打开浏览器
```

---

## 🔧 配置文件

### frontend/.env（可选）

**作用：** 配置后端 API 地址

**默认值：** `http://localhost:5000/api`

**何时需要修改：**
- ✅ 后端运行在不同端口
- ✅ 使用不同的后端服务器
- ✅ 部署到生产环境

---

## 📝 配置项说明

### 1. REACT_APP_API_URL

**说明：** 后端 API 的基础地址

**默认值：** `http://localhost:5000/api`（代码中有默认值）

**示例：**

#### 本地开发（默认）
```env
REACT_APP_API_URL=http://localhost:5000/api
```

#### 后端在不同端口
```env
REACT_APP_API_URL=http://localhost:8080/api
```

#### 使用远程服务器
```env
REACT_APP_API_URL=https://api.example.com/api
```

#### Docker Compose 环境
```env
REACT_APP_API_URL=http://backend:5000/api
```

---

### 2. PORT ⭐ 新增

**说明：** 前端开发服务器运行的端口

**默认值：** `3000`

**何时修改：**
- ✅ 端口 3000 被占用
- ✅ 同时运行多个 React 项目
- ✅ 公司规定使用特定端口

**示例：**

#### 默认端口
```env
PORT=3000
```

#### 自定义端口
```env
PORT=8080
```

#### 避免端口冲突
```env
PORT=3001
```

**注意：** 
- 修改端口后，访问地址变为 `http://localhost:你的端口`
- 如果端口被占用，React 会提示是否使用其他端口
- **不需要** `REACT_APP_` 前缀（这是 React 内置变量）

---

### 3. BROWSER

**说明：** 控制是否自动打开浏览器

**默认值：** 自动打开

**示例：**

#### 不自动打开浏览器
```env
BROWSER=none
```

#### 指定浏览器（Windows）
```env
BROWSER="C:\Program Files\Google\Chrome\Application\chrome.exe"
```

#### 指定浏览器（Mac）
```env
BROWSER=/Applications/Google\ Chrome.app/Contents/MacOS/Google\ Chrome
```

---

### 4. 其他可选配置

#### 关闭自动刷新
```env
FAST_REFRESH=false
```

#### 关闭 ESLint
```env
DISABLE_ESLINT_PLUGIN=true
```

#### 生成 source map
```env
GENERATE_SOURCEMAP=false
```

---

## 💡 使用方式

### 1. 自动创建（推荐）

运行启动脚本，会自动创建：
```bash
start.bat  # Windows
./start.sh  # Mac/Linux
```

选择选项 2，脚本会自动创建 `frontend/.env` 文件。

### 2. 手动创建

如果需要自定义配置：

**创建文件：** `frontend/.env`

**内容：**
```env
# 后端 API 地址
REACT_APP_API_URL=http://localhost:5000/api

# 前端开发服务器端口
PORT=3000

# 不自动打开浏览器
BROWSER=none

# 其他配置（可选）
# REACT_APP_DEBUG=true
```

---

## 🔍 代码中如何使用

在 `frontend/src/api/api.js` 中：

```javascript
const api = axios.create({
  baseURL: process.env.REACT_APP_API_URL || 'http://localhost:5000/api',
  headers: {
    'Content-Type': 'application/json'
  }
});
```

**逻辑：**
1. 优先使用环境变量 `REACT_APP_API_URL`
2. 如果没有配置，使用默认值 `http://localhost:5000/api`

---

## ⚙️ React 环境变量规则

### 1. 命名规则
所有自定义环境变量**必须**以 `REACT_APP_` 开头：

✅ **正确：**
```env
REACT_APP_API_URL=...
REACT_APP_DEBUG=...
REACT_APP_VERSION=...
```

❌ **错误：**
```env
API_URL=...          # 不会被识别
MY_CONFIG=...        # 不会被识别
```

### 2. 内置变量（不需要 REACT_APP_ 前缀）

React 有一些内置环境变量：

- `NODE_ENV` - 自动设置（development/production/test）
- `PUBLIC_URL` - 公共资源路径
- `PORT` - 开发服务器端口 ⭐
- `BROWSER` - 浏览器设置
- `FAST_REFRESH` - 热更新开关
- `GENERATE_SOURCEMAP` - 是否生成 source map

### 3. 修改后需重启
修改 `.env` 文件后，**必须重启开发服务器**才能生效！

```bash
Ctrl + C  # 停止服务器
npm start # 重新启动
```

---

## 📦 不同环境的配置

### 开发环境
**文件：** `frontend/.env` 或 `frontend/.env.development`

```env
REACT_APP_API_URL=http://localhost:5000/api
```

### 生产环境
**文件：** `frontend/.env.production`

```env
REACT_APP_API_URL=https://api.yourdomain.com/api
```

### 测试环境
**文件：** `frontend/.env.test`

```env
REACT_APP_API_URL=http://localhost:5000/api
```

### 优先级
```
.env.local > .env.development > .env
```

---

## 🚀 部署时的配置

### Docker 构建

**Dockerfile.frontend** 中，在构建时传入环境变量：

```dockerfile
# 在构建阶段传入
ARG REACT_APP_API_URL
ENV REACT_APP_API_URL=$REACT_APP_API_URL

# 或在 docker build 时指定
docker build --build-arg REACT_APP_API_URL=https://api.example.com/api -t frontend .
```

### Nginx 代理（推荐）

如果前后端在同一域名下，可以不配置 API URL，使用 Nginx 代理：

**nginx.conf:**
```nginx
location /api {
    proxy_pass http://backend:5000;
}
```

**前端配置：**
```env
# 使用相对路径，Nginx 会代理到后端
REACT_APP_API_URL=/api
```

---

## 🔐 安全注意事项

### ⚠️ 重要警告

1. **不要存储敏感信息**
   ```env
   # ❌ 不要这样做
   REACT_APP_API_KEY=secret123
   REACT_APP_PASSWORD=password
   ```

2. **前端环境变量会暴露**
   - 所有 `REACT_APP_*` 变量会被打包到 JavaScript 中
   - 用户可以在浏览器中查看
   - **不要存储密钥、密码等敏感信息！**

3. **使用 .gitignore**
   ```gitignore
   # 忽略环境变量文件
   .env
   .env.local
   .env.*.local
   
   # 但可以提交示例文件
   !.env.example
   ```

---

## 🎯 实际场景

### 场景1：默认开发环境
**不需要配置文件！** 代码中的默认值已经足够。

### 场景2：修改前端端口
创建 `frontend/.env`：
```env
# 前端运行在 8080 端口
PORT=8080
REACT_APP_API_URL=http://localhost:5000/api
```

### 场景3：后端在不同端口
创建 `frontend/.env`：
```env
PORT=3000
REACT_APP_API_URL=http://localhost:8080/api
```

### 场景4：连接远程后端
创建 `frontend/.env`：
```env
PORT=3000
REACT_APP_API_URL=https://dev-api.example.com/api
```

### 场景5：端口被占用
如果 3000 端口被占用，修改 `frontend/.env`：
```env
PORT=3001  # 或其他可用端口
REACT_APP_API_URL=http://localhost:5000/api
```

### 场景6：同时运行多个项目
项目A：
```env
PORT=3000
```

项目B：
```env
PORT=3001
```

项目C：
```env
PORT=3002
```

### 场景7：团队协作
1. 创建 `frontend/.env.example`（提交到 Git）
   ```env
   # 后端 API 地址
   REACT_APP_API_URL=http://localhost:5000/api
   
   # 前端端口
   PORT=3000
   ```

2. 每个开发者复制并修改自己的 `.env`（不提交）
   ```bash
   cp frontend/.env.example frontend/.env
   ```

---

## 🛠️ 调试技巧

### 查看环境变量
在代码中添加：
```javascript
console.log('API URL:', process.env.REACT_APP_API_URL);
console.log('Node ENV:', process.env.NODE_ENV);
console.log('All env:', process.env);
```

### 验证 API 地址
打开浏览器控制台 → Network 标签，查看请求地址是否正确。

### 常见问题

**问题1：修改 .env 不生效**
- **原因：** 需要重启开发服务器
- **解决：** Ctrl+C 停止，然后 `npm start`

**问题2：变量值是 undefined**
- **原因：** 变量名没有 `REACT_APP_` 前缀
- **解决：** 重命名变量

**问题3：API 请求 404**
- **原因：** API 地址配置错误
- **解决：** 检查 `REACT_APP_API_URL` 是否正确

**问题4：端口被占用**
- **错误：** `Something is already running on port 3000`
- **解决方案1：** 在 `.env` 中设置 `PORT=3001`
- **解决方案2：** 关闭占用 3000 端口的程序
- **解决方案3：** 当 React 提示时，选择使用其他端口（如 3001）

**问题5：修改 PORT 不生效**
- **原因：** 端口配置写错了位置或格式
- **解决：** 确保在 `frontend/.env` 中，不要写在 `backend/.env`
- **正确格式：** `PORT=3000`（没有引号）

---

## 📚 总结

### 前端配置文件特点

| 特性 | 说明 |
|------|------|
| **是否必需** | ❌ 不必需（有默认值） |
| **何时使用** | 修改端口、API地址等 |
| **主要配置** | PORT（端口）、REACT_APP_API_URL（API地址） |
| **命名规则** | 自定义变量需要 `REACT_APP_` 前缀 |
| **修改生效** | 需要重启开发服务器 |
| **安全性** | 会暴露在前端代码中 |
| **自动创建** | ✅ 启动脚本自动创建 |

### 常用配置项

| 配置项 | 说明 | 默认值 | 需要前缀 |
|--------|------|--------|----------|
| `PORT` | 前端端口 | 3000 | ❌ |
| `REACT_APP_API_URL` | API地址 | http://localhost:5000/api | ✅ |
| `BROWSER` | 浏览器设置 | 自动打开 | ❌ |
| `FAST_REFRESH` | 热更新 | true | ❌ |

### 推荐做法

1. **本地开发：** 使用启动脚本自动创建，默认配置即可
2. **修改端口：** 在 `.env` 中设置 `PORT=你的端口`
3. **团队协作：** 创建 `.env.example` 文件供参考
4. **生产部署：** 使用 `.env.production` 或构建时传入
5. **敏感信息：** 永远不要放在前端环境变量中

---

## 🔗 相关文档

- [React 环境变量官方文档](https://create-react-app.dev/docs/adding-custom-environment-variables/)
- [项目 README](./README.md)
- [MongoDB 使用说明](./MongoDB使用说明.md)

---

**提示：** 大多数情况下，您不需要修改前端配置，使用默认值即可！

---

*最后更新：2024年*

