# 配置文件总览 📋

## 🎯 项目配置文件一览

本项目有两个主要的配置文件，启动脚本会**自动创建**它们。

---

## 📦 后端配置文件

### backend/.env ⭐ 必需

**作用：** 后端服务器配置

**位置：** `backend/.env`

**自动创建：** ✅ 是

**内容：**
```env
PORT=5000
MONGODB_URI=mongodb://localhost:27017/destiny-analysis
JWT_SECRET=destiny_analysis_jwt_secret_2024_change_in_production
JWT_EXPIRE=30d
NODE_ENV=development
```

### 配置项说明

| 配置项 | 说明 | 默认值 | 必需 |
|--------|------|--------|------|
| `PORT` | 后端服务器端口 | 5000 | ✅ |
| `MONGODB_URI` | MongoDB 连接地址 | mongodb://localhost:27017/destiny-analysis | ✅ |
| `JWT_SECRET` | JWT 加密密钥 | 自动生成 | ✅ |
| `JWT_EXPIRE` | Token 过期时间 | 30d | ✅ |
| `NODE_ENV` | 运行环境 | development | ✅ |

---

## 🎨 前端配置文件

### frontend/.env ⭐ 可选

**作用：** 前端开发服务器和 API 配置

**位置：** `frontend/.env`

**自动创建：** ✅ 是

**是否必需：** ❌ 否（代码中有默认值）

**内容：**
```env
# 前端环境变量配置

# 后端 API 地址
REACT_APP_API_URL=http://localhost:5000/api

# 前端开发服务器端口（默认3000）
PORT=3000

# 如果端口被占用，是否自动选择其他端口
# BROWSER=none  # 不自动打开浏览器
```

### 配置项说明

| 配置项 | 说明 | 默认值 | 必需 | 前缀要求 |
|--------|------|--------|------|----------|
| `REACT_APP_API_URL` | 后端 API 地址 | http://localhost:5000/api | ❌ | ✅ 需要 |
| `PORT` | 前端服务器端口 | 3000 | ❌ | ❌ 不需要 |
| `BROWSER` | 浏览器设置 | 自动打开 | ❌ | ❌ 不需要 |

---

## 🚀 自动创建机制

### 启动脚本行为

当您运行 `start.bat`（Windows）或 `start.sh`（Mac/Linux）并选择**选项 2（本地开发模式）**时：

#### 步骤1：检查 backend/.env
```
如果不存在 → 自动创建，写入默认配置
如果存在   → 跳过
```

#### 步骤2：检查 frontend/.env
```
如果不存在 → 自动创建，写入默认配置
如果存在   → 跳过
```

#### 步骤3：显示提示
```
🔧 配置后端环境变量...
✅ 已创建后端默认 .env 文件

🔧 配置前端环境变量...
✅ 已创建前端默认 .env 文件
```

---

## 📝 何时需要修改配置

### 后端配置（backend/.env）

#### ✅ 需要修改的情况
- 端口 5000 被占用
- 使用远程 MongoDB
- 修改 JWT 密钥（生产环境）

#### ❌ 通常不需要修改
- 本地开发使用默认配置即可

---

### 前端配置（frontend/.env）

#### ✅ 需要修改的情况
- 端口 3000 被占用
- 后端运行在不同端口
- 连接远程后端 API

#### ❌ 通常不需要修改
- 本地开发使用默认配置即可（代码中有默认值）

---

## 🎯 常见配置场景

### 场景1：默认开发环境（推荐）

**无需任何配置！** 启动脚本自动处理，使用默认值即可。

```
前端：http://localhost:3000
后端：http://localhost:5000
MongoDB：localhost:27017
```

---

### 场景2：修改前端端口

**frontend/.env:**
```env
PORT=8080  # 修改这里
REACT_APP_API_URL=http://localhost:5000/api
```

访问：`http://localhost:8080`

---

### 场景3：修改后端端口

**backend/.env:**
```env
PORT=8000  # 修改这里
MONGODB_URI=mongodb://localhost:27017/destiny-analysis
JWT_SECRET=destiny_analysis_jwt_secret_2024_change_in_production
JWT_EXPIRE=30d
NODE_ENV=development
```

**frontend/.env:**
```env
PORT=3000
REACT_APP_API_URL=http://localhost:8000/api  # 同步修改
```

---

### 场景4：前后端都修改端口

**backend/.env:**
```env
PORT=8000
...
```

**frontend/.env:**
```env
PORT=8080
REACT_APP_API_URL=http://localhost:8000/api
```

访问：
- 前端：`http://localhost:8080`
- 后端：`http://localhost:8000`

---

### 场景5：使用远程 MongoDB

**backend/.env:**
```env
PORT=5000
MONGODB_URI=mongodb://username:password@your-mongo-server:27017/destiny-analysis
JWT_SECRET=your_secure_secret_key
JWT_EXPIRE=30d
NODE_ENV=development
```

---

## 🔄 配置文件生命周期

### 创建
```
启动脚本自动创建 → 写入默认配置
```

### 使用
```
应用读取配置 → 启动服务
```

### 修改
```
手动编辑文件 → 重启服务生效
```

### 删除
```
删除配置文件 → 下次启动自动重新创建
```

---

## ⚠️ 重要提示

### 1. 修改后必须重启

修改任何配置文件后，都需要重启对应的服务：

```bash
# 停止服务
Ctrl + C

# 重新启动
npm run dev  # 或 npm start
```

### 2. 配置文件不提交到 Git

`.env` 文件已经在 `.gitignore` 中：

```gitignore
# 环境变量
.env
backend/.env
frontend/.env
```

### 3. 团队协作使用 .env.example

创建示例文件供参考：

**backend/.env.example:**
```env
PORT=5000
MONGODB_URI=mongodb://localhost:27017/destiny-analysis
JWT_SECRET=change_this_in_production
JWT_EXPIRE=30d
NODE_ENV=development
```

**frontend/.env.example:**
```env
REACT_APP_API_URL=http://localhost:5000/api
PORT=3000
```

---

## 📚 详细文档

| 文档 | 说明 |
|------|------|
| [前端配置说明.md](./前端配置说明.md) | 前端配置详细文档 |
| [端口配置快速参考.md](./端口配置快速参考.md) | 端口配置快速指南 |
| [MongoDB使用说明.md](./MongoDB使用说明.md) | MongoDB 配置和管理 |
| [快速开始.md](./快速开始.md) | 项目启动指南 |
| [README.md](./README.md) | 项目完整文档 |

---

## 🎓 配置优先级

### React 环境变量优先级（从高到低）

1. `.env.local`（本地覆盖，不提交）
2. `.env.development` / `.env.production`（环境特定）
3. `.env`（通用配置）
4. 代码中的默认值

### Node.js 环境变量优先级

1. 命令行指定：`PORT=8000 npm start`
2. `.env` 文件
3. 系统环境变量
4. 代码中的默认值

---

## 🔐 安全建议

### 开发环境
- ✅ 使用默认配置
- ✅ 不要提交 `.env` 文件
- ✅ 提供 `.env.example` 示例

### 生产环境
- ✅ 使用强 JWT 密钥
- ✅ 使用环境变量而非文件
- ✅ 限制 MongoDB 访问权限
- ✅ 启用 HTTPS
- ✅ 设置合理的 Token 过期时间

---

## 💡 最佳实践

1. **本地开发**
   - 使用启动脚本，自动创建配置
   - 使用默认端口和配置
   - 不提交 `.env` 文件

2. **团队协作**
   - 创建 `.env.example` 文件
   - 在 README 中说明配置方法
   - 使用一致的默认配置

3. **生产部署**
   - 使用环境变量
   - 不在代码中硬编码配置
   - 定期轮换密钥

4. **故障排除**
   - 检查配置文件是否存在
   - 确认配置格式正确
   - 重启服务使配置生效
   - 查看日志确认配置加载

---

## 🆘 快速故障排除

### 配置不生效？
- [ ] 确认修改了正确的文件
- [ ] 确认没有拼写错误
- [ ] 确认已经重启服务
- [ ] 查看控制台是否有错误

### 端口冲突？
- [ ] 修改 `PORT` 配置
- [ ] 关闭占用端口的程序
- [ ] 使用其他端口

### API 连接失败？
- [ ] 确认后端正在运行
- [ ] 检查 `REACT_APP_API_URL`
- [ ] 确认端口号一致

---

**提示：** 使用默认配置最简单，只在必要时才修改！

---

*最后更新：2024年*

