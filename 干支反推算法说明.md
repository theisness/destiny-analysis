# å¹²æ”¯åæ¨æ—¥æœŸç®—æ³•è¯´æ˜

## ğŸ“‹ é—®é¢˜æè¿°

ç”¨æˆ·æŒ‡å‡ºï¼šæ ¹æ®å¹²æ”¯è®¡ç®—æ—¥æœŸçš„æ–¹å¼é”™è¯¯ï¼Œ**å¤©å¹²åœ°æ”¯æ˜¯60ä¸€è½®å›**ï¼Œè€Œä¸æ˜¯ä¹‹å‰ä½¿ç”¨çš„ç®€åŒ–ç®—æ³•ã€‚

## âŒ æ—§ç®—æ³•çš„é—®é¢˜

ä¹‹å‰çš„å®ç°ä½¿ç”¨äº†é”™è¯¯çš„åœ°æ”¯12å¤©è½®å›ç®—æ³•ï¼š

```javascript
const dayZhi = sizhu.day[1];
const zhiIndex = DI_ZHI.indexOf(dayZhi);

// âŒ é”™è¯¯ï¼šå‡è®¾åœ°æ”¯12å¤©ä¸€å¾ªç¯
const possibleDay = (zhiIndex + 1 + (month * 3)) % 28 + 1;
```

è¿™ä¸ªç®—æ³•å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š
1. **ç†è®ºé”™è¯¯** - æ—¥æŸ±æ˜¯å¤©å¹²åœ°æ”¯ç»„åˆï¼Œ60å¤©ä¸€è½®å›ï¼Œä¸æ˜¯12å¤©
2. **ç»“æœä¸å‡†** - è®¡ç®—å‡ºçš„æ—¥æœŸä¸å®é™…å››æŸ±ä¸åŒ¹é…
3. **é—æ¼ç»„åˆ** - å¾ˆå¤šæœ‰æ•ˆçš„å¹²æ”¯ç»„åˆæ— æ³•æ‰¾åˆ°å¯¹åº”æ—¥æœŸ

## âœ… æ–°ç®—æ³•ï¼šå…­åç”²å­

### ç†è®ºåŸºç¡€

**å…­åç”²å­**æ˜¯ä¸­å›½ä¼ ç»Ÿçºªæ—¥æ–¹æ³•ï¼š

```
å¤©å¹²ï¼ˆ10ä¸ªï¼‰ï¼šç”²ã€ä¹™ã€ä¸™ã€ä¸ã€æˆŠã€å·±ã€åºšã€è¾›ã€å£¬ã€ç™¸
åœ°æ”¯ï¼ˆ12ä¸ªï¼‰ï¼šå­ã€ä¸‘ã€å¯…ã€å¯ã€è¾°ã€å·³ã€åˆã€æœªã€ç”³ã€é…‰ã€æˆŒã€äº¥

ç»„åˆæ–¹å¼ï¼š
- å¤©å¹²å’Œåœ°æ”¯æŒ‰é¡ºåºç»„åˆ
- ä»"ç”²å­"å¼€å§‹ï¼Œç»è¿‡60ä¸ªç»„åˆåˆ°"ç™¸äº¥"
- æœ€å°å…¬å€æ•°ï¼šLCM(10, 12) = 60
```

### å…­åç”²å­è¡¨

| åºå· | å¹²æ”¯ | åºå· | å¹²æ”¯ | åºå· | å¹²æ”¯ | åºå· | å¹²æ”¯ | åºå· | å¹²æ”¯ |
|------|------|------|------|------|------|------|------|------|------|
| 0    | ç”²å­ | 12   | ä¸™å­ | 24   | æˆŠå­ | 36   | åºšå­ | 48   | å£¬å­ |
| 1    | ä¹™ä¸‘ | 13   | ä¸ä¸‘ | 25   | å·±ä¸‘ | 37   | è¾›ä¸‘ | 49   | ç™¸ä¸‘ |
| 2    | ä¸™å¯… | 14   | æˆŠå¯… | 26   | åºšå¯… | 38   | å£¬å¯… | 50   | ç”²å¯… |
| 3    | ä¸å¯ | 15   | å·±å¯ | 27   | è¾›å¯ | 39   | ç™¸å¯ | 51   | ä¹™å¯ |
| 4    | æˆŠè¾° | 16   | åºšè¾° | 28   | å£¬è¾° | 40   | ç”²è¾° | 52   | ä¸™è¾° |
| 5    | å·±å·³ | 17   | è¾›å·³ | 29   | ç™¸å·³ | 41   | ä¹™å·³ | 53   | ä¸å·³ |
| 6    | åºšåˆ | 18   | å£¬åˆ | 30   | ç”²åˆ | 42   | ä¸™åˆ | 54   | æˆŠåˆ |
| 7    | è¾›æœª | 19   | ç™¸æœª | 31   | ä¹™æœª | 43   | ä¸æœª | 55   | å·±æœª |
| 8    | å£¬ç”³ | 20   | ç”²ç”³ | 32   | ä¸™ç”³ | 44   | æˆŠç”³ | 56   | åºšç”³ |
| 9    | ç™¸é…‰ | 21   | ä¹™é…‰ | 33   | ä¸é…‰ | 45   | å·±é…‰ | 57   | è¾›é…‰ |
| 10   | ç”²æˆŒ | 22   | ä¸™æˆŒ | 34   | æˆŠæˆŒ | 46   | åºšæˆŒ | 58   | å£¬æˆŒ |
| 11   | ä¹™äº¥ | 23   | ä¸äº¥ | 35   | å·±äº¥ | 47   | è¾›äº¥ | 59   | ç™¸äº¥ |

### è®¡ç®—å¹²æ”¯åºå·

ç»™å®šä¸€ä¸ªå¹²æ”¯ç»„åˆï¼Œè®¡ç®—å…¶åœ¨å…­åç”²å­ä¸­çš„åºå·ï¼š

```javascript
const getDayGanZhiIndex = (ganZhi) => {
  const gan = ganZhi[0];        // å¤©å¹²
  const zhi = ganZhi[1];        // åœ°æ”¯
  const ganIndex = TIAN_GAN.indexOf(gan);   // 0-9
  const zhiIndex = DI_ZHI.indexOf(zhi);     // 0-11
  
  // æ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„åºå· iï¼š
  // i % 10 === ganIndex  (å¤©å¹²åŒ¹é…)
  // i % 12 === zhiIndex  (åœ°æ”¯åŒ¹é…)
  for (let i = 0; i < 60; i++) {
    if (i % 10 === ganIndex && i % 12 === zhiIndex) {
      return i;
    }
  }
  return 0;
};
```

**ç¤ºä¾‹**ï¼š
- ç”²å­ï¼šganIndex=0, zhiIndex=0 â†’ åºå·=0
- ä¹™ä¸‘ï¼šganIndex=1, zhiIndex=1 â†’ åºå·=1
- ç”²æˆŒï¼šganIndex=0, zhiIndex=10 â†’ åºå·=10

## ğŸ”§ å®ç°æ–¹æ¡ˆ

### æ–¹æ¡ˆä¸€ï¼šåç«¯ APIï¼ˆé¦–é€‰ï¼‰

åˆ›å»º `/api/bazi/reverse-calculate` ç«¯ç‚¹ï¼Œä½¿ç”¨ `lunar-javascript` åº“ç²¾ç¡®è®¡ç®—ï¼š

```javascript
router.post('/reverse-calculate', protect, async (req, res) => {
  const { sizhu } = req.body;
  const { Solar } = require('lunar-javascript');
  const dates = [];
  
  // éå†æ—¥æœŸèŒƒå›´
  for (let year = startYear; year <= endYear; year++) {
    for (let month = 1; month <= 12; month++) {
      for (let day = 1; day <= daysInMonth; day++) {
        // æ ¹æ®æ—¶æŸ±æ¨ç®—æ—¶è¾°
        const hour = hourIndex * 2;
        
        // ä½¿ç”¨ lunar-javascript è®¡ç®—å››æŸ±
        const solar = Solar.fromYmdHms(year, month, day, hour, 0, 0);
        const lunar = solar.getLunar();
        
        const yearGanZhi = lunar.getYearInGanZhi();
        const monthGanZhi = lunar.getMonthInGanZhi();
        const dayGanZhi = lunar.getDayInGanZhi();
        const timeGanZhi = lunar.getTimeInGanZhi();
        
        // å®Œå…¨åŒ¹é…å››æŸ±
        if (yearGanZhi === sizhu.year && 
            monthGanZhi === sizhu.month && 
            dayGanZhi === sizhu.day && 
            timeGanZhi === sizhu.hour) {
          dates.push({ year, month, day, hour });
        }
      }
    }
  }
  
  res.json({ success: true, dates });
});
```

**ä¼˜ç‚¹**ï¼š
- âœ… ç²¾ç¡®åŒ¹é…æ‰€æœ‰å››æŸ±
- âœ… è€ƒè™‘äº†æœˆæŸ±å’Œå¹´æŸ±çš„è®¡ç®—è§„åˆ™
- âœ… ä½¿ç”¨æˆç†Ÿçš„å¤©æ–‡å†æ³•åº“

### æ–¹æ¡ˆäºŒï¼šå‰ç«¯é™çº§è®¡ç®—

å¦‚æœåç«¯ API ä¸å¯ç”¨ï¼Œå‰ç«¯ä½¿ç”¨å…­åç”²å­ç®—æ³•ï¼š

```javascript
const calculatePossibleDatesLocal = () => {
  const dates = [];
  const targetDayIndex = getDayGanZhiIndex(sizhu.day);
  
  // åŸºå‡†æ—¥ï¼š1900å¹´1æœˆ1æ—¥ = ç”²æˆŒæ—¥ï¼ˆåºå·10ï¼‰
  const baseDate = new Date(1900, 0, 1);
  const baseDayIndex = 10;
  
  // éå†æ—¥æœŸ
  for (let year = startYear; year <= endYear; year++) {
    for (let month = 1; month <= 12; month++) {
      for (let day = 1; day <= daysInMonth; day++) {
        const checkDate = new Date(year, month - 1, day);
        
        // è®¡ç®—å¤©æ•°å·®
        const diffDays = Math.floor(
          (checkDate - baseDate) / (1000 * 60 * 60 * 24)
        );
        
        // è®¡ç®—å¹²æ”¯åºå·
        const currentDayIndex = (baseDayIndex + diffDays) % 60;
        
        // åŒ¹é…æ—¥æŸ±
        if (currentDayIndex === targetDayIndex) {
          dates.push({ year, month, day, hour });
        }
      }
    }
  }
  
  return dates;
};
```

**ä¼˜ç‚¹**ï¼š
- âœ… ä½¿ç”¨æ­£ç¡®çš„å…­åç”²å­ç®—æ³•
- âœ… æ— éœ€åç«¯æ”¯æŒ
- âœ… é€‚åˆä½œä¸ºé™çº§æ–¹æ¡ˆ

**å±€é™**ï¼š
- âš ï¸ åªèƒ½ç²¾ç¡®åŒ¹é…æ—¥æŸ±
- âš ï¸ æœˆæŸ±ã€å¹´æŸ±çš„åŒ¹é…ä¸å¤Ÿå‡†ç¡®ï¼ˆéœ€è¦è€ƒè™‘èŠ‚æ°”ï¼‰

## ğŸ“Š ç®—æ³•å¯¹æ¯”

| ç‰¹æ€§ | æ—§ç®—æ³• | å‰ç«¯å…­åç”²å­ | åç«¯ API |
|------|--------|-------------|----------|
| ç†è®ºæ­£ç¡®æ€§ | âŒ é”™è¯¯ | âœ… æ­£ç¡® | âœ… æ­£ç¡® |
| æ—¥æŸ±åŒ¹é… | âŒ ä¸å‡†ç¡® | âœ… ç²¾ç¡® | âœ… ç²¾ç¡® |
| æ—¶æŸ±åŒ¹é… | âš ï¸ ç®€åŒ– | âœ… å‡†ç¡® | âœ… ç²¾ç¡® |
| æœˆæŸ±åŒ¹é… | âŒ æ—  | âš ï¸ ä¸å‡†ç¡® | âœ… ç²¾ç¡® |
| å¹´æŸ±åŒ¹é… | âŒ æ—  | âš ï¸ ä¸å‡†ç¡® | âœ… ç²¾ç¡® |
| æ€§èƒ½ | å¿« | ä¸­ç­‰ | è¾ƒæ…¢ |
| ä¾èµ– | æ—  | æ—  | åç«¯ |

## ğŸ¯ ä½¿ç”¨å»ºè®®

1. **é¦–é€‰åç«¯ API** - è·å–æœ€å‡†ç¡®çš„ç»“æœ
2. **å‰ç«¯é™çº§** - å½“åç«¯ä¸å¯ç”¨æ—¶ä½¿ç”¨
3. **ç”¨æˆ·é€‰æ‹©** - å¦‚æœæ‰¾ä¸åˆ°åŒ¹é…æ—¥æœŸï¼Œæä¾›"ç›´æ¥ä½¿ç”¨å››æŸ±"é€‰é¡¹

## ğŸ“š å‚è€ƒèµ„æ–™

- [å…­åç”²å­ - ç»´åŸºç™¾ç§‘](https://zh.wikipedia.org/wiki/å…­åç”²å­)
- [lunar-javascript æ–‡æ¡£](https://github.com/6tail/lunar-javascript)
- [å¹²æ”¯çºªæ—¥æ³•](https://baike.baidu.com/item/å¹²æ”¯çºªæ—¥æ³•)

## ğŸ”— ç›¸å…³æ–‡ä»¶

- `backend/routes/bazi.js` - åç«¯åæ¨ API
- `frontend/src/pages/BaziInput/BaziInput.js` - å‰ç«¯è®¡ç®—é€»è¾‘
- `æ›´æ–°æ—¥å¿—.md` - v1.2.0 æ›´æ–°è¯´æ˜

